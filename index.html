<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Senior Project</title>
    <meta name="viewport" content="initial-scale=1.0" />

    <link href="stylesheets/bootstrap.min.css" rel="stylesheet" />
    <link href="stylesheets/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="stylesheets/desktop.css" rel="stylesheet" />

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="javascripts/html5shiv.js"></script>
    <![endif]-->

    <!-- Fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/apple-touch-icon-144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/apple-touch-icon-72.png" />
    <link rel="apple-touch-icon-precomposed" href="images/apple-touch-icon-57.png" />
    <link rel="shortcut icon" href="images/favicon.png" />
		
    <!-- Javascripts -->
    <script src="javascripts/jquery-1.9.1.min.js"></script>
    <script src="javascripts/bootstrap.min.js"></script>
    <script src="javascripts/jquery.photoset-grid.min.js"></script>
		<script src="javascripts/jquery.iosslider.min.js"></script>
    <script src="javascripts/instafeed.min.js"></script>

    <!-- Hide the address bar in mobile safari -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
					
					<!-- .btn-navbar is used as the toggle for collapsed navbar content -->
		      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		      </a>
					
					<!-- Be sure to leave the brand out there if you want it shown -->
          <a class="brand" href="/">Local</a>

					<!-- Everything you want hidden at 940px or less, place within here -->
		      <div class="nav-collapse collapse">
	          <ul class="nav">
	            <li class="active"><a href="#" class="local">Local</a></li>
	            <li><a href="#" data-latitude="40.7142" data-longitude="-74.0064">New York</a></li>
              <li><a href="#" data-latitude="33.7499" data-longitude="-84.3881">Atlanta</a></li>
              <li><a href="#" data-latitude="37.7750" data-longitude="-122.4183">San Francisco</a></li>
              <li><a href="#" data-latitude="41.8376" data-longitude="-87.6818">Chicago</a></li>
              <li><a href="#" data-latitude="29.7805" data-longitude="-95.3863">Houston</a></li>
              <li><a href="#" data-latitude="34.0194" data-longitude="-118.4108">Los Angeles</a></li>
	          </ul>
        </div>
      </div>
    </div>

    <div id="stream" class="container-fluid">

     <div class="row-fluid">
    	<div class="span12">

    		<div class='iosSlider'>
    			<div id="photos" class='slider'>
    				<div class="loading">
    					<img src="images/loading.gif"/>
    				</div>
    			</div>
    		</div>

    	</div>
    </div>

    <script type="text/javascript">

    function resetPhotos()
    {
    	$(".collapse").collapse({
    	  toggle: false
    	});
    	$(".collapse").collapse('hide');

    	$('.iosSlider').iosSlider('destroy');
    	$(".slider").empty();
    	$(".slider").append(
    		$("<div>").addClass("loading").append(
    			$("<img>").attr("src", "images/loading.gif")
    		)
    	);
    }

    function initializeSlider()
    {
    	$('.iosSlider').iosSlider({
    		snapToChildren: true,
    		desktopClickDrag: true,
    		infiniteSlider: true,
    		snapSlideCenter: true,
    		responsiveSlideContainer: true,
    		responsiveSlides: true
    	});
    }

    function loadByLocation(latitude, longitude, title)
    {
    	resetPhotos();

      var feed = new Instafeed({
        get: 'tagged',
        tagName: 'awesome',
        clientId: '5c7f36fcb0d84a7da3193094da8556fd',
        target: 'photos',
        resolution: 'standard_resolution',
        template: '<div class="slide"><a href="instagram://media?id={{id}}"><img src="{{image}}" /></a><div class="meta"><div class="profile_picture"><a href="instagram://user?username={{model.user.username}}"><img src="{{model.user.profile_picture}}" class="pull-left img-rounded" /></a></div><div class="profile_username"><span class="username"><a href="instagram://user?username={{model.user.username}}">{{model.user.username}}</a></span></div><div class="caption"><span class="caption_text">{{caption}}</span></div></div></div>',
        after: function() {
          initializeSlider();
          $(".brand").html(title);  
        },
        error: function (msg) {
          alert("Unable to get photos from Instagram. ("+msg+")");
        }
      });
      feed.run();
    }

    function processLocation(location)
    {
    	$(".local").attr("data-latitude", location.coords.latitude).attr("data-longitude", location.coords.longitude);
    	loadByLocation(location.coords.latitude, location.coords.longitude, 'Local');
    }

    function handleError(error)
    {
      alert("Unable to get location: " + error.message);
    }

    $(document).ready(function() {
    	navigator.geolocation.getCurrentPosition(processLocation, handleError);

    	window.addEventListener("load",function() {
    		// Set a timeout...
    		setTimeout(function(){
    			// Hide the address bar!
    			window.scrollTo(0, 1);
    		}, 0);
    	});

    	$(".nav li a").on("click", function(event){
      	event.preventDefault();

        var latitude = $(this).attr('data-latitude');
        var longitude = $(this).attr('data-longitude');
        var title = $(this).html();

        loadByLocation(latitude, longitude, title); 
        $('.nav li').removeClass('active'); 
        $(this).parent().addClass('active'); 
    	});
    });

    </script>

      
    </div> <!-- /container -->

  </body>
</html>
